<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data Structures Canvas Visualization</title>

    <!-- Import D3.js (Required for physics forces) -->
    <script src="https://unpkg.com/d3"></script>
    <!-- Import 2D Force Graph -->
    <script src="https://unpkg.com/force-graph"></script>

    <style>
      /* --- Color Palette & Variables --- */
      :root {
        /* Default (Dark Mode) */
        --bg-main: #050510;
        --text-main: #e0e0e0;
        --text-muted: #aaa;

        /* Panel & UI */
        --panel-bg: rgba(5, 20, 40, 0.9);
        --panel-border: rgba(137, 207, 240, 0.3);
        --header-bg: rgba(0, 0, 0, 0.6);

        /* Nav */
        --nav-bg: rgba(0, 31, 63, 0.3);
        --nav-item-bg: rgba(255, 255, 255, 0.05);
        --nav-item-hover: rgba(137, 207, 240, 0.1);
        --nav-item-active-text: #050510;

        /* Accents */
        --accent-blue: #89cff0;
        --accent-gold: #ffd700;

        /* Canvas Background */
        --canvas-gradient: radial-gradient(
          circle at center,
          #0a0a20 0%,
          #000000 100%
        );
        --overlay-text: #666;
      }

      body.light-mode {
        /* Light Mode Overrides */
        --bg-main: #ffffff;
        --text-main: #1a1a1a;
        --text-muted: #555;

        /* Panel & UI */
        --panel-bg: rgba(255, 255, 255, 0.9);
        --panel-border: rgba(0, 0, 0, 0.1);
        --header-bg: rgba(255, 255, 255, 0.8);

        /* Nav */
        --nav-bg: rgba(240, 240, 240, 0.8);
        --nav-item-bg: rgba(0, 0, 0, 0.05);
        --nav-item-hover: rgba(0, 102, 204, 0.1);
        --nav-item-active-text: #ffffff;

        /* Accents - Darker for visibility on white */
        --accent-blue: #0066cc;
        --accent-gold: #d4af37;

        /* Canvas Background */
        --canvas-gradient: radial-gradient(
          circle at center,
          #ffffff 0%,
          #f0f4f8 100%
        );
        --overlay-text: #888;
      }

      body {
        font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        margin: 0;
        background-color: var(--bg-main);
        color: var(--text-main);
        overflow: hidden;
        height: 100vh;
        display: flex;
        flex-direction: column;
        transition: background-color 0.3s, color 0.3s;
      }

      /* --- Header --- */
      header {
        padding: 15px 30px;
        background: var(--header-bg);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid var(--panel-border);
        display: flex;
        align-items: center;
        justify-content: space-between;
        z-index: 10;
        transition: background 0.3s, border-color 0.3s;
      }

      h1 {
        margin: 0;
        font-size: 1.4rem;
        color: var(--accent-blue);
        letter-spacing: 1px;
      }

      .header-controls {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .button {
        background: transparent;
        border: 1px solid var(--accent-blue);
        color: var(--accent-blue);
        padding: 6px 16px;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s;
        text-decoration: none;
        font-size: 0.85rem;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .button:hover {
        background: var(--accent-blue);
        color: var(--bg-main);
      }

      /* --- Navigation --- */
      #topics-nav {
        background: var(--nav-bg);
        padding: 10px 20px;
        display: flex;
        gap: 10px;
        overflow-x: auto;
        white-space: nowrap;
        border-bottom: 1px solid var(--panel-border);
        z-index: 10;
        transition: background 0.3s;
      }

      #topics-nav::-webkit-scrollbar {
        height: 3px;
      }
      #topics-nav::-webkit-scrollbar-thumb {
        background: var(--accent-blue);
      }

      .nav-item {
        background: var(--nav-item-bg);
        color: var(--text-muted);
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 0.9rem;
        border: 1px solid transparent;
      }

      .nav-item:hover {
        color: var(--text-main);
        background: var(--nav-item-hover);
        border-color: var(--accent-blue);
      }

      .nav-item.active {
        color: var(--nav-item-active-text);
        background: var(--accent-blue);
        font-weight: bold;
        box-shadow: 0 0 12px rgba(137, 207, 240, 0.3);
      }

      /* --- Main Layout --- */
      #main-container {
        flex: 1;
        position: relative;
        display: flex;
        overflow: hidden;
      }

      /* --- Canvas Container --- */
      #graph-canvas {
        flex: 1;
        background: var(--canvas-gradient);
        cursor: grab;
        transition: background 0.5s ease;
      }
      #graph-canvas:active {
        cursor: grabbing;
      }

      /* --- Info Panel --- */
      #info-panel {
        position: absolute;
        right: 20px;
        top: 20px;
        width: 320px;
        background: var(--panel-bg);
        backdrop-filter: blur(12px);
        border-left: 3px solid var(--accent-blue);
        border-radius: 8px;
        padding: 25px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        transform: translateX(400px);
        transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275),
          background 0.3s;
        z-index: 20;
      }

      #info-panel.visible {
        transform: translateX(0);
      }

      #info-panel h4 {
        color: var(--accent-blue);
        margin: 0 0 10px 0;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 1.5px;
      }

      #info-panel h2 {
        margin: 0 0 15px 0;
        color: var(--accent-gold);
        font-size: 1.3rem;
        line-height: 1.3;
      }

      #info-panel p {
        line-height: 1.6;
        font-size: 0.9rem;
        color: var(--text-main);
        margin: 0;
      }

      /* --- Overlay Text --- */
      .instruction-overlay {
        position: absolute;
        bottom: 20px;
        left: 20px;
        font-family: monospace;
        color: var(--overlay-text);
        font-size: 0.8rem;
        pointer-events: none;
        transition: color 0.3s;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>
        Data Structures
        <span style="font-size: 0.7em; color: var(--text-muted)"
          >// Interactive Canvas</span
        >
      </h1>

      <div class="header-controls">
        <button class="button" id="theme-toggle" onclick="toggleTheme()">
          ☀ Mode
        </button>
        <a href="home.html" class="button">← Back</a>
      </div>
    </header>

    <nav id="topics-nav"></nav>

    <div id="main-container">
      <div id="graph-canvas"></div>

      <div class="instruction-overlay">
        > Drag to pan • Scroll to zoom • Click nodes to select
      </div>

      <div id="info-panel">
        <h4 id="panel-label">Summary</h4>
        <h2 id="panel-title">Topic Details</h2>
        <p id="panel-desc">Select a node to view details.</p>
      </div>
    </div>

    <script>
      // 1. DATA DEFINITION
      const dsModules = [
        {
          id: "ds-intro",
          title: "01. Intro to DS",
          longDescription:
            "Foundations of data organization. Covers Big O notation, time/space complexity analysis, and basic memory allocation strategies.",
          color: "#ff0055",
          prerequisites: [
            {
              id: "p1",
              title: "Basic Programming",
              description:
                "Control flow (if/else), loops, and syntax in C/Java/Python.",
            },
            {
              id: "p2",
              title: "Data Types",
              description: "Primitives: int, float, char, boolean.",
            },
            {
              id: "p3",
              title: "Arrays",
              description: "Contiguous memory allocation and indexing.",
            },
            {
              id: "p4",
              title: "Loops",
              description: "Iterative logic construction.",
            },
          ],
        },
        {
          id: "ds-stacks",
          title: "02. Stacks & Queues",
          longDescription:
            "Linear data structures. Stack (LIFO) used in recursion/undo. Queue (FIFO) used in scheduling/buffering.",
          color: "#00cc88",
          prerequisites: [
            {
              id: "p3",
              title: "Arrays",
              description: "Used for static implementation of stacks.",
            },
            {
              id: "p5",
              title: "Functions",
              description: "Modularizing Push, Pop, and Peek operations.",
            },
            {
              id: "p6",
              title: "Expressions",
              description: "Infix, Prefix, Postfix conversion logic.",
            },
            {
              id: "p7",
              title: "ADT",
              description: "Abstract Data Types concept.",
            },
          ],
        },
        {
          id: "ds-linked",
          title: "03. Linked Lists",
          longDescription:
            "Nodes linked via pointers. Allows dynamic memory usage. Includes Singly, Doubly, and Circular lists.",
          color: "#22aaff",
          prerequisites: [
            {
              id: "p8",
              title: "Pointers",
              description: "Memory addressing and dereferencing.",
            },
            {
              id: "p9",
              title: "Dynamic Memory",
              description: "Heap allocation (malloc/new).",
            },
            {
              id: "p10",
              title: "Structs",
              description: "Creating custom data types for Nodes.",
            },
            {
              id: "p11",
              title: "Memory Layout",
              description: "Understanding non-contiguous memory.",
            },
          ],
        },
        {
          id: "ds-trees",
          title: "04. Trees",
          longDescription:
            "Hierarchical structures. Binary Trees, BST, AVL. Essential for fast searching and sorting data.",
          color: "#ffaa00",
          prerequisites: [
            {
              id: "p12",
              title: "Linked Lists",
              description:
                "Tree nodes are essentially linked list nodes with multiple pointers.",
            },
            {
              id: "p13",
              title: "Recursion",
              description: "The primary method for traversing trees.",
            },
            {
              id: "p14",
              title: "Stack",
              description: "Used for iterative traversals (DFS).",
            },
            {
              id: "p15",
              title: "Binary Search",
              description: "The logic behind BST efficiency.",
            },
          ],
        },
        {
          id: "ds-graphs",
          title: "05. Graphs",
          longDescription:
            "Complex networks (Social media, Maps). Nodes (Vertices) and Edges. Algorithms: BFS, DFS, Dijkstra.",
          color: "#9900ff",
          prerequisites: [
            {
              id: "p16",
              title: "Tree Traversal",
              description:
                "Graph traversal is a generalization of tree traversal.",
            },
            {
              id: "p17",
              title: "Queue & Stack",
              description: "BFS uses Queue, DFS uses Stack.",
            },
            {
              id: "p18",
              title: "Matrices",
              description: "Adjacency Matrix representation.",
            },
            {
              id: "p13",
              title: "Recursion",
              description: "Deep traversal logic.",
            },
          ],
        },
        {
          id: "ds-search",
          title: "06. Searching",
          longDescription:
            "Finding data efficiently. Linear Search (O(n)) vs Binary Search (O(log n)) vs Hashing (O(1)).",
          color: "#00ccff",
          prerequisites: [
            {
              id: "p3",
              title: "Arrays",
              description: "The dataset structure.",
            },
            {
              id: "p15",
              title: "Algorithms",
              description: "Step-by-step logic execution.",
            },
            {
              id: "p19",
              title: "Math (Modulo)",
              description: "Key for Hash Function design.",
            },
            {
              id: "p20",
              title: "Logic",
              description: "Optimizing for edge cases.",
            },
          ],
        },
      ];

      // 2. SETUP VARIABLES
      let Graph;
      let selectedNode = null; // Track the currently selected node
      const container = document.getElementById("graph-canvas");

      // 3. INITIALIZATION
      document.addEventListener("DOMContentLoaded", () => {
        // Set initial theme based on system preference
        const prefersLight =
          window.matchMedia &&
          window.matchMedia("(prefers-color-scheme: light)").matches;
        const btn = document.getElementById("theme-toggle");

        if (prefersLight) {
          document.body.classList.add("light-mode");
          if (btn) btn.textContent = "☾ Dark";
        } else {
          if (btn) btn.textContent = "☀ Light";
        }

        renderNav();
        // Check if ForceGraph is loaded, if not retry after short delay
        if (typeof ForceGraph !== "undefined") {
          loadModuleGraph(dsModules[0].id);
        } else {
          setTimeout(() => {
            if (typeof ForceGraph !== "undefined") {
              loadModuleGraph(dsModules[0].id);
            } else {
              console.error("ForceGraph library failed to load.");
            }
          }, 500);
        }
      });

      // THEME TOGGLE LOGIC
      function toggleTheme() {
        document.body.classList.toggle("light-mode");
        const btn = document.getElementById("theme-toggle");
        const isLight = document.body.classList.contains("light-mode");

        btn.textContent = isLight ? "☾ Dark" : "☀ Light";

        // Force graph re-render to update text colors
        if (Graph) {
          // We trigger a data update to force a canvas redraw
          const currentData = Graph.graphData();
          Graph.graphData(currentData);
        }
      }

      // 4. NAVIGATION RENDERER
      function renderNav() {
        const nav = document.getElementById("topics-nav");
        dsModules.forEach((mod) => {
          const div = document.createElement("div");
          div.className = "nav-item";
          div.textContent = mod.title;
          div.onclick = () => {
            document
              .querySelectorAll(".nav-item")
              .forEach((el) => el.classList.remove("active"));
            div.classList.add("active");
            loadModuleGraph(mod.id);
          };
          nav.appendChild(div);
        });
        nav.children[0].classList.add("active");
      }

      // 5. PANEL UPDATER
      function updatePanel(title, desc, type, color) {
        const panel = document.getElementById("info-panel");
        const lbl = document.getElementById("panel-label");
        const h2 = document.getElementById("panel-title");
        const p = document.getElementById("panel-desc");

        // Get current computed styles for accent blue if fallback needed
        const style = getComputedStyle(document.body);
        const accentColor = style.getPropertyValue("--accent-blue").trim();

        panel.classList.add("visible");
        panel.style.borderLeftColor = color || accentColor;

        lbl.textContent = type === "MAIN" ? "MAIN MODULE" : "PREREQUISITE";
        lbl.style.color = color || accentColor;

        h2.textContent = title;
        p.textContent = desc;
      }

      // 6. GRAPH ENGINE (CANVAS)
      function loadModuleGraph(moduleId) {
        selectedNode = null; // Reset selection when changing modules
        const module = dsModules.find((m) => m.id === moduleId);
        if (!module) return;

        updatePanel(module.title, module.longDescription, "MAIN", module.color);

        // Prepare Data
        const nodes = [
          {
            id: module.id,
            name: module.title,
            desc: module.longDescription,
            group: "main",
            color: module.color,
            val: 25, // Main node size
          },
        ];

        const links = [];
        module.prerequisites.forEach((prereq) => {
          nodes.push({
            id: prereq.id,
            name: prereq.title,
            desc: prereq.description,
            group: "prereq",
            color: "#888888", // Default placeholder, overwritten in renderer
            val: 10, // Child node size
          });

          links.push({
            source: module.id,
            target: prereq.id,
          });
        });

        const gData = { nodes, links };

        // Initialize or Update Graph
        if (!Graph) {
          // Double check D3 availability for forces
          const chargeForce =
            typeof d3 !== "undefined"
              ? d3.forceManyBody().strength(-200)
              : null;
          const linkForce =
            typeof d3 !== "undefined" ? d3.forceLink().distance(150) : null;

          Graph = ForceGraph()(container)
            .backgroundColor("#00000000") // Transparent, letting CSS bg show

            // --- INTERACTION ---
            .onNodeClick((node) => {
              selectedNode = node; // Set selected node

              Graph.centerAt(node.x, node.y, 1000);
              Graph.zoom(2, 1000);

              const style = getComputedStyle(document.body);
              const accentColor = style
                .getPropertyValue("--accent-blue")
                .trim();

              updatePanel(
                node.name,
                node.desc,
                node.group === "main" ? "MAIN" : "PREREQ",
                node.group === "main" ? node.color : accentColor
              );
            })
            .onBackgroundClick(() => {
              selectedNode = null; // Deselect on background click
              Graph.zoomToFit(1000);
            })

            // --- CANVAS RENDERING ---
            .nodeCanvasObject((node, ctx, globalScale) => {
              const label = node.name;
              const fontSize = (node.group === "main" ? 14 : 12) / globalScale;
              const isSelected = selectedNode && node.id === selectedNode.id;

              // Check Theme
              const isLightMode =
                document.body.classList.contains("light-mode");

              // 1. Draw Outer Glow (Halo) - Enhanced if selected
              if (node.group === "main" || isSelected) {
                ctx.beginPath();
                ctx.arc(
                  node.x,
                  node.y,
                  node.val * (isSelected ? 1.5 : 1.2),
                  0,
                  2 * Math.PI,
                  false
                );
                // Glow color depends on theme
                ctx.fillStyle = isSelected
                  ? "rgba(255, 215, 0, 0.3)"
                  : isLightMode
                  ? "rgba(0,0,0,0.05)"
                  : "rgba(255,255,255,0.1)";
                ctx.fill();
              }

              // 2. Draw Node Circle
              ctx.beginPath();
              ctx.arc(node.x, node.y, node.val, 0, 2 * Math.PI, false);

              // Determine Node Color
              // Prereq nodes: White in dark mode, Dark Grey in light mode (unless selected)
              let nodeColor = node.color;
              if (node.group !== "main") {
                nodeColor = isLightMode ? "#666666" : "#ffffff";
              }

              // INTERACTIVE COLOR CHANGE: Gold if selected
              ctx.fillStyle = isSelected ? "#ffd700" : nodeColor;

              ctx.shadowBlur = isSelected ? 30 : 15;
              ctx.shadowColor = isSelected ? "#ffd700" : nodeColor;
              ctx.fill();

              // Reset shadow for text
              ctx.shadowBlur = 0;

              // 3. Draw Text Label
              ctx.font = `${
                node.group === "main" ? "bold" : ""
              } ${fontSize}px Sans-Serif`;
              ctx.textAlign = "center";
              ctx.textBaseline = "middle";

              // TEXT COLOR: Needs to flip based on theme
              ctx.fillStyle = isLightMode ? "#1a1a1a" : "#ffffff";

              // Draw text below the node
              ctx.fillText(label, node.x, node.y + node.val + 8);
            })

            // --- POINTER AREA (Hitbox) ---
            .nodePointerAreaPaint((node, color, ctx) => {
              ctx.fillStyle = color;
              ctx.beginPath();
              ctx.arc(node.x, node.y, node.val + 5, 0, 2 * Math.PI, false);
              ctx.fill();
            })

            // --- LINKS ---
            // INTERACTIVE LINK COLOR: Gold if connected to selected node
            .linkColor((link) => {
              if (
                selectedNode &&
                (link.source.id === selectedNode.id ||
                  link.target.id === selectedNode.id)
              ) {
                return "#ff0055";
              }
              // Link color varies by theme
              const isLightMode =
                document.body.classList.contains("light-mode");
              return isLightMode
                ? "rgba(0, 102, 204, 0.2)"
                : "rgba(137, 207, 240, 0.2)";
            })
            .linkWidth((link) => {
              if (
                selectedNode &&
                (link.source.id === selectedNode.id ||
                  link.target.id === selectedNode.id)
              ) {
                return 3; // Thicker if active
              }
              return 2;
            })
            .linkDirectionalParticles(3) // Moving dots
            .linkDirectionalParticleWidth(3)
            .linkDirectionalParticleColor(() => {
              const isLightMode =
                document.body.classList.contains("light-mode");
              return isLightMode ? "#0066cc" : "#89cff0";
            });

          // Apply forces if d3 is loaded
          if (chargeForce) Graph.d3Force("charge", chargeForce);
          if (linkForce) Graph.d3Force("link", linkForce);
        }

        // Update Data
        Graph.graphData(gData);

        // Reset View
        setTimeout(() => Graph.zoomToFit(600, 50), 200);
      }

      // Handle resize
      window.addEventListener("resize", () => {
        if (Graph)
          Graph.width(window.innerWidth).height(window.innerHeight - 80);
      });
    </script>
  </body>
</html>
